import { IResourceItem, Action } from "@refinedev/core";
import i18n from "i18next"; // 直接引入你的 i18n 配置文件中的实例

// 从环境变量获取应用名称
const APP_NAME = import.meta.env.VITE_APP_NAME || "Luna Tech";

type HandlerOptions = {
  resource?: IResourceItem;
  action?: Action;
  params?: Record<string, string | undefined>;
  pathname?: string;
  autoGeneratedTitle?: string;
};

export const customTitleHandler = ({
  resource,
  action,
  params,
  autoGeneratedTitle,
}: HandlerOptions): string => {
  const t = i18n.t; // 获取翻译函数
  let title = autoGeneratedTitle;

  // 1. 如果有资源信息和动作
  if (resource && action) {
    // 获取资源的翻译名称，如果设置了 label 则用 label，否则用资源名
    const resourceName = t(resource?.meta?.translateKey);

    switch (action) {
      case "list":
        // 翻译结果示例："Gestione Clienti" 或 "客户档案管理"
        title = t("documentTitle.management", {
          resource: resourceName,
        });
        break;
      case "create":
        title = t("documentTitle.new", {
          resource: resourceName,
        });
        break;
      case "edit": {
        const editLabel = t("documentTitle.edit", {
          resource: resourceName,
        });
        title = `${editLabel} ${params?.id ? `#${params.id}` : ""}`;
        break;
      }
      case "show": {
        const showLabel = t("documentTitle.details", {
          resource: resourceName,
        });
        title = `${showLabel} ${params?.id ? `#${params.id}` : ""}`;
        break;
      }
      default: {
        // 兜底：[动作名] - [资源名]
        const actionLabel = t(`actions.${action}`, action);
        title = `${actionLabel} - ${resourceName}`;
      }
    }
  }
  // 2. 处理 Auth 页面 (登录/注册/忘记密码)
  else {
    const path = window.location.pathname;
    if (path.includes("/login")) {
      title = t("pages.login.title");
    } else if (path.includes("/register")) {
      title = t("pages.register.title");
    } else if (path.includes("/forgot-password")) {
      title = t("pages.forgotPassword.title");
    } else if (path.includes("/my")) {
      title = t("pages.myProfile.title");
    } else if (path.includes("/mfa-verify")) {
      title = t("pages.myProfile.verify.title");
    }
  }

  // 3. 拼接后缀
  // 优先从 i18n 获取后缀（如 " | Luna Tech"），否则使用环境变量
  const suffix = t("documentTitle.suffix", { defaultValue: ` | ${APP_NAME}` });

  return `${title}${suffix}`;
};
