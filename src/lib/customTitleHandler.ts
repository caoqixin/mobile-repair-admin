import { IResourceItem, Action } from "@refinedev/core";

// 定义应用名称
const APP_NAME = import.meta.env.VITE_APP_NAME;

// 定义资源名称的中文映射 (如果您的 i18n 文件还没完全覆盖，这里可以做兜底)
const RESOURCE_LABEL_MAP: Record<string, string> = {
  repair_orders: "维修订单",
  customers: "客户档案",
  inventory_components: "维修库存",
  inventory_items: "零售商品",
  sales_orders: "销售收银",
  dashboard: "仪表盘",
  quotes: "极速报价",
};

// 定义动作名称的中文映射
const ACTION_LABEL_MAP: Record<string, string> = {
  list: "列表",
  create: "新建",
  edit: "编辑",
  show: "详情",
  clone: "克隆",
};

type HandlerOptions = {
  resource?: IResourceItem;
  action?: Action;
  params?: Record<string, string | undefined>;
  pathname?: string;
  autoGeneratedTitle: string;
};

export const customTitleHandler = ({
  resource,
  action,
  params,
  autoGeneratedTitle,
}: HandlerOptions): string => {
  let title = autoGeneratedTitle; // 默认使用 Refine 生成的标题作为回退

  // 1. 如果有资源信息 (Resource)
  if (resource && action) {
    const resourceName =
      resource.meta?.label ??
      RESOURCE_LABEL_MAP[resource.name] ??
      resource.name;
    const actionName = ACTION_LABEL_MAP[action] ?? action;

    switch (action) {
      case "list":
        title = `${resourceName}管理`;
        break;
      case "create":
        title = `新建${resourceName}`;
        break;
      case "edit":
        // 如果 URL 中有 ID，尝试展示
        title = `编辑${resourceName} ${params?.id ? `#${params.id}` : ""}`;
        break;
      case "show":
        title = `${resourceName}详情 ${params?.id ? `#${params.id}` : ""}`;
        break;
      default:
        title = `${actionName} - ${resourceName}`;
    }
  }
  // 2. 处理 Dashboard (通常 action 为 undefined 或 list)
  else if (resource?.name === "dashboard") {
    title = "数据仪表盘";
  }
  // 3. 处理登录/注册等无资源页面 (Refine 可能会将 auth 视为资源，也可能没有)
  else if (!resource && !action) {
    // 简单的路径判断兜底
    if (window.location.pathname.includes("login")) title = "系统登录";
    else if (window.location.pathname.includes("register")) title = "注册账户";
  }

  // 4. 返回带后缀的完整标题
  return `${title} | ${APP_NAME}`;
};
